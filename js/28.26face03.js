"use strict";(self["webpackChunkvue_frontend"]=self["webpackChunkvue_frontend"]||[]).push([[28],{4028:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});a(4114);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"profile-container"},[e("div",{staticClass:"profile-header"},[e("h1",[t._v("个人主页")]),e("button",{staticClass:"edit-btn",on:{click:t.toggleEditMode}},[t._v(" "+t._s(t.isEditing?"取消编辑":"编辑信息")+" ")])]),t.isAuthenticated?t.currentUser?e("div",{staticClass:"profile-content"},[e("div",{staticClass:"avatar-section"},[e("div",{staticClass:"avatar-container",class:{editing:t.isEditing}},[e("div",{staticClass:"avatar",style:{backgroundImage:`url(${t.tempAvatar||t.currentUser.avatar||"/default-avatar.png"})`}}),t.isEditing?e("input",{ref:"avatarUpload",staticStyle:{display:"none"},attrs:{type:"file",id:"avatar-upload",accept:"image/*"},on:{change:t.handleAvatarUpload}}):t._e(),t.isEditing?e("label",{staticClass:"avatar-upload-btn",attrs:{for:"avatar-upload"}},[t._v(" 更换头像 ")]):t._e()])]),e("div",{staticClass:"info-section"},[t.isEditing?e("form",{on:{submit:function(e){return e.preventDefault(),t.handleUpdateProfile.apply(null,arguments)}}},[e("div",{staticClass:"form-group"},[e("label",[t._v("用户名")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.username,expression:"tempUser.username"}],staticClass:"disabled-input",attrs:{type:"text",disabled:"",placeholder:"用户名不可修改"},domProps:{value:t.tempUser.username},on:{input:function(e){e.target.composing||t.$set(t.tempUser,"username",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"email"}},[t._v("邮箱")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.email,expression:"tempUser.email"}],attrs:{type:"email",id:"email",disabled:!t.isEditing,required:"",placeholder:"请输入邮箱"},domProps:{value:t.tempUser.email},on:{input:function(e){e.target.composing||t.$set(t.tempUser,"email",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"nickname"}},[t._v("昵称")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.nickname,expression:"tempUser.nickname"}],attrs:{type:"text",id:"nickname",disabled:!t.isEditing,placeholder:"请输入昵称",maxlength:"20"},domProps:{value:t.tempUser.nickname},on:{input:function(e){e.target.composing||t.$set(t.tempUser,"nickname",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",[t._v("性别")]),e("div",{staticClass:"radio-group"},[e("label",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.gender,expression:"tempUser.gender"}],attrs:{type:"radio",disabled:!t.isEditing,value:"male"},domProps:{checked:t._q(t.tempUser.gender,"male")},on:{change:function(e){return t.$set(t.tempUser,"gender","male")}}}),t._v(" 男 ")]),e("label",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.gender,expression:"tempUser.gender"}],attrs:{type:"radio",disabled:!t.isEditing,value:"female"},domProps:{checked:t._q(t.tempUser.gender,"female")},on:{change:function(e){return t.$set(t.tempUser,"gender","female")}}}),t._v(" 女 ")]),e("label",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.gender,expression:"tempUser.gender"}],attrs:{type:"radio",disabled:!t.isEditing,value:"other"},domProps:{checked:t._q(t.tempUser.gender,"other")},on:{change:function(e){return t.$set(t.tempUser,"gender","other")}}}),t._v(" 保密 ")])])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"birthday"}},[t._v("生日")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.birthday,expression:"tempUser.birthday"}],attrs:{type:"date",id:"birthday",disabled:!t.isEditing,max:t.maxDate},domProps:{value:t.tempUser.birthday},on:{input:function(e){e.target.composing||t.$set(t.tempUser,"birthday",e.target.value)}}})]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"bio"}},[t._v("个人简介")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.bio,expression:"tempUser.bio"}],attrs:{id:"bio",disabled:!t.isEditing,placeholder:"请输入个人简介",rows:"4",maxlength:"200"},domProps:{value:t.tempUser.bio},on:{input:function(e){e.target.composing||t.$set(t.tempUser,"bio",e.target.value)}}}),e("div",{staticClass:"char-count"},[t._v(t._s((t.tempUser.bio||"").length)+"/200")])]),e("div",{staticClass:"form-group"},[e("label",{attrs:{for:"contact"}},[t._v("联系方式")]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.contact,expression:"tempUser.contact"}],attrs:{type:"text",id:"contact",disabled:!t.isEditing,placeholder:"请输入联系方式",maxlength:"50"},domProps:{value:t.tempUser.contact},on:{input:function(e){e.target.composing||t.$set(t.tempUser,"contact",e.target.value)}}})]),e("div",{staticClass:"form-actions"},[e("button",{staticClass:"save-btn",attrs:{type:"submit",disabled:t.saving}},[t._v(" "+t._s(t.saving?"保存中...":"保存修改")+" ")]),t.isEditing?e("button",{staticClass:"cancel-btn",attrs:{type:"button"},on:{click:t.cancelEdit}},[t._v(" 取消 ")]):t._e()])]):e("div",{staticClass:"profile-info"},[e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("用户名：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.currentUser.username))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("邮箱：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.currentUser.email||"未设置"))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("昵称：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.currentUser.nickname||"未设置"))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("性别：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.getGenderText(t.currentUser.gender)))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("生日：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.formatDate(t.currentUser.birthday)||"未设置"))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("个人简介：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.currentUser.bio||"未设置"))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("联系方式：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.currentUser.contact||"未设置"))])]),e("div",{staticClass:"info-item"},[e("span",{staticClass:"info-label"},[t._v("注册时间：")]),e("span",{staticClass:"info-value"},[t._v(t._s(t.formatDateTime(t.currentUser.createdAt)))])])]),e("div",{staticClass:"function-buttons"},[e("button",{staticClass:"function-btn",on:{click:t.openChangePassword}},[t._v("修改密码")]),e("button",{staticClass:"function-btn",on:{click:t.switchAccount}},[t._v("切换账号")]),e("button",{staticClass:"function-btn",on:{click:t.logout}},[t._v("退出登录")]),e("button",{staticClass:"function-btn",on:{click:t.checkUpdate}},[t._v("检查更新")])])])]):t._e():e("div",{staticClass:"not-logged-in"},[e("p",[t._v("请先登录后查看个人信息")]),e("button",{staticClass:"login-btn",on:{click:function(e){return t.$router.push("/")}}},[t._v("前往登录")])]),t.loading?e("div",{staticClass:"loading"},[t._v("加载中...")]):t._e(),t.error?e("div",{staticClass:"error-message"},[t._v(t._s(t.error))]):t._e()])},i=[],r=a(5353),n={name:"ProfilePage",data(){return{isEditing:!1,tempUser:{},tempAvatar:"",saving:!1,error:"",maxDate:(new Date).toISOString().split("T")[0]}},computed:{...(0,r.aH)(["isAuthenticated","currentUser","loading"])},watch:{currentUser:{immediate:!0,handler(t){t&&this.resetTempUser()}}},created(){this.isAuthenticated&&this.currentUser&&this.resetTempUser()},methods:{...(0,r.i0)(["loadUserInfo","updateUserInfo"]),toggleEditMode(){this.isEditing?this.cancelEdit():(this.isEditing=!0,this.resetTempUser())},resetTempUser(){this.tempUser={username:this.currentUser.username,email:this.currentUser.email||"",nickname:this.currentUser.nickname||"",gender:this.currentUser.gender||"other",birthday:this.currentUser.birthday?new Date(this.currentUser.birthday).toISOString().split("T")[0]:"",bio:this.currentUser.bio||"",contact:this.currentUser.contact||""},this.tempAvatar="",this.error=""},handleAvatarUpload(t){const e=t.target.files[0];if(e){const t=["image/jpeg","image/png","image/gif"];if(!t.includes(e.type))return void(this.error="请上传JPG、PNG或GIF格式的图片");if(e.size>2097152)return void(this.error="图片大小不能超过2MB");const a=new FileReader;a.onload=t=>{this.tempAvatar=t.target.result},a.readAsDataURL(e)}},async handleUpdateProfile(){this.error="",this.saving=!0;try{const t={...this.tempUser};this.tempAvatar&&(t.avatar=this.tempAvatar);const e=await this.updateUserInfo(t);e.success?(this.isEditing=!1,this.resetTempUser(),alert("个人信息更新成功")):this.error=e.error||"更新失败，请稍后重试"}catch(t){this.error="更新失败，请稍后重试",console.error("更新个人信息错误:",t)}finally{this.saving=!1}},cancelEdit(){this.isEditing=!1,this.resetTempUser(),this.error=""},formatDate(t){if(!t)return"";const e=new Date(t);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},formatDateTime(t){if(!t)return"";const e=new Date(t);return`${this.formatDate(e)} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},getGenderText(t){switch(t){case"male":return"男";case"female":return"女";default:return"保密"}},openChangePassword(){alert("修改密码功能将在这里实现")},switchAccount(){this.logout(),setTimeout(()=>{this.$router.push("/")},500)},logout(){this.$store.dispatch("logout").then(()=>{alert("退出登录成功")}).catch(()=>{alert("退出登录失败，请稍后重试")})},checkUpdate(){alert("检查更新中..."),setTimeout(()=>{alert("当前已是最新版本")},1e3)}}},o=n,l=a(1656),c=(0,l.A)(o,s,i,!1,null,"d892d71e",null),d=c.exports}}]);
//# sourceMappingURL=28.26face03.js.map