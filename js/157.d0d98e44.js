"use strict";(self["webpackChunkvue_frontend"]=self["webpackChunkvue_frontend"]||[]).push([[157],{507:function(t,e,i){var s=i(9565);t.exports=function(t,e,i){var n,a,r=i?t:t.iterator,o=t.next;while(!(n=s(o,r)).done)if(a=e(n.value),void 0!==a)return a}},655:function(t,e,i){var s=i(6955),n=String;t.exports=function(t){if("Symbol"===s(t))throw new TypeError("Cannot convert a Symbol value to a string");return n(t)}},1157:function(t,e,i){i.r(e),i.d(e,{default:function(){return nt}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"blog-detail"},[e("h1",[t._v(t._s(t.blog?.title||"Âä†ËΩΩ‰∏≠..."))]),t.blog?e("div",{staticClass:"blog-content"},[e("div",{staticClass:"blog-meta"},[e("span",[t._v("‰ΩúËÄÖ: "+t._s(t.blog.author))]),e("span",[t._v("ÂàõÂª∫Êó∂Èó¥: "+t._s(t.formatDate(t.blog.createdAt)))]),t.blog.updatedAt!==t.blog.createdAt?e("span",[t._v("Êõ¥Êñ∞Êó∂Èó¥: "+t._s(t.formatDate(t.blog.updatedAt)))]):t._e(),e("span",[t._v("Áä∂ÊÄÅ: "+t._s("published"===t.blog.status?"Â∑≤ÂèëÂ∏É":"ËçâÁ®ø"))]),t.blog.source?e("span",[t._v("Êù•Ê∫ê: "+t._s(t.blog.source))]):t._e()]),e("div",{staticClass:"simple-stats"},[e("span",{staticClass:"stat-item"},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"}})]),t._v(" "+t._s(t.blog.viewCount||0)+" ")]),e("span",{staticClass:"stat-item"},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{d:"M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"}})]),t._v(" "+t._s(t.blog.commentCount||0)+" ")]),e("span",{staticClass:"stat-item"},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14l-6-6z"}})]),t._v(" "+t._s(t.blog.forwardCount||0)+" ")]),e("span",{staticClass:"stat-item likes"},[e("svg",{attrs:{width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"}},[e("path",{attrs:{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"}})]),t._v(" "+t._s(t.blog.likeCount||0)+" ")])]),t.blog.tags&&t.blog.tags.length>0?e("div",{staticClass:"blog-tags"},t._l(t.blog.tags,function(i){return e("span",{key:i.id||i,staticClass:"tag"},[t._v(" # "+t._s(i.name||i)+" ")])}),0):t._e(),e("div",{staticClass:"content"},[e("p",[t._v(t._s(t.blog.content))])]),e("div",{staticClass:"interaction-actions"},[e("LikeButton",{staticClass:"simple-like-button",attrs:{"blog-id":t.blog.id,"initial-like-count":t.blog.likeCount||0,"initial-is-liked":t.blog.isLiked||!1},on:{"like-change":t.handleLikeChange}}),e("FavoriteButton",{attrs:{"blog-id":t.blog.id}}),e("button",{staticClass:"btn",on:{click:t.goBack}},[t._v("ËøîÂõûÂàóË°®")])],1),e("CommentList",{attrs:{"blog-id":t.blog.id}})],1):t.loading?t._e():e("div",{staticClass:"error"},[t._v(" ÂçöÂÆ¢‰∏çÂ≠òÂú®ÊàñÂ∑≤Ë¢´Âà†Èô§ ")])])},n=[],a=(i(4114),i(5426)),r=i(2564),o=function(){var t=this,e=t._self._c;return e("button",{staticClass:"like-btn",class:{liked:t.isLiked},attrs:{disabled:t.loading},on:{click:t.toggleLike}},[e("span",{staticClass:"icon"},[t._v(" "+t._s(t.isLiked?"‚ù§Ô∏è":"ü§ç")+" ")]),e("span",{staticClass:"count"},[t._v(t._s(t.likeCount||0))]),t.loading?e("span",{staticClass:"loading"},[t._v("...")]):t._e()])},l=[],c=(i(8111),i(2489),i(116),i(1701),i(2505)),d=i.n(c);const u=(t=300)=>new Promise(e=>setTimeout(e,t)),m=async t=>{try{await u(200);const e=a.Ko.find(e=>e.id===t);return e?{data:{isLiked:e.isLiked||!1,likeCount:e.likeCount||0}}:{data:{isLiked:!1,likeCount:0}}}catch(e){throw console.error("Ëé∑ÂèñÁÇπËµûÁä∂ÊÄÅÂ§±Ë¥•:",e),e}},g=async t=>{try{await u(300);const e=a.Ko.find(e=>e.id===t);return e?(void 0===e.likeCount&&(e.likeCount=0),e.isLiked||(e.likeCount++,e.isLiked=!0),{data:{success:!0,isLiked:!0,likeCount:e.likeCount}}):{data:{success:!1,isLiked:!1,likeCount:0}}}catch(e){throw console.error("ÁÇπËµûÂ§±Ë¥•:",e),e}},h=async t=>{try{await u(300);const e=a.Ko.find(e=>e.id===t);return e?(void 0===e.likeCount&&(e.likeCount=0),e.isLiked&&(e.likeCount=Math.max(0,e.likeCount-1),e.isLiked=!1),{data:{success:!0,isLiked:!1,likeCount:e.likeCount}}):{data:{success:!1,isLiked:!1,likeCount:0}}}catch(e){throw console.error("ÂèñÊ∂àÁÇπËµûÂ§±Ë¥•:",e),e}};var p={name:"LikeButton",props:{blogId:{type:Number,required:!0},initialLikeCount:{type:Number,default:0},initialIsLiked:{type:Boolean,default:!1}},data(){return{isLiked:!1,likeCount:0,loading:!1}},created(){void 0!==this.initialLikeCount?(this.likeCount=this.initialLikeCount,this.isLiked=this.initialIsLiked):this.fetchLikeStatus()},methods:{async fetchLikeStatus(){try{this.loading=!0;const t=await m(this.blogId);this.isLiked=t.data?.isLiked||!1,this.likeCount=t.data?.likeCount||0}catch(t){console.error("Ëé∑ÂèñÁÇπËµûÁä∂ÊÄÅÂ§±Ë¥•:",t)}finally{this.loading=!1}},async toggleLike(){if(!this.loading)try{let t;this.loading=!0,t=this.isLiked?await h(this.blogId):await g(this.blogId),t.data&&(this.isLiked=t.data.isLiked,this.likeCount=t.data.likeCount||this.likeCount+(this.isLiked?1:-1),this.$emit("like-change",{blogId:this.blogId,isLiked:this.isLiked,likeCount:this.likeCount}))}catch(t){console.error("Êõ¥Êñ∞ÁÇπËµûÁä∂ÊÄÅÂ§±Ë¥•:",t)}finally{this.loading=!1}}}},f=p,v=i(1656),k=(0,v.A)(f,o,l,!1,null,"2b146040",null),y=k.exports,C=function(){var t=this,e=t._self._c;return e("button",{staticClass:"favorite-btn",class:{favorited:t.isFavorited},attrs:{disabled:t.loading},on:{click:t.toggleFavorite}},[e("span",{staticClass:"icon"},[t._v(" "+t._s(t.isFavorited?"‚òÖ":"‚òÜ")+" ")]),e("span",{staticClass:"text"},[t._v(t._s(t.isFavorited?"Â∑≤Êî∂Ëóè":"Êî∂Ëóè"))]),t.loading?e("span",{staticClass:"loading"},[t._v("...")]):t._e()])},b=[];const w=!0,I=d().create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json"}}),_=[{id:1,blogId:1,userId:"user1",createdAt:"2024-03-15T10:30:00"},{id:2,blogId:2,userId:"user1",createdAt:"2024-03-16T14:20:00"},{id:3,blogId:5,userId:"user1",createdAt:"2024-03-17T09:15:00"}],L="user1",S=t=>new Promise(e=>setTimeout(e,t)),x=async t=>{if(w){await S(200);const e=_.some(e=>e.userId===L&&e.blogId===t);return{data:{isFavorite:e}}}return I.get(`/favorites/check/${t}`)},A=async t=>{if(w){await S(300);const e=Math.max(..._.map(t=>t.id),0)+1,i={id:e,blogId:t,userId:L,createdAt:(new Date).toISOString()};return _.push(i),{data:i}}return I.post("/favorites",{blogId:t})},$=async t=>{if(w){await S(300);const e=_.findIndex(e=>e.userId===L&&e.blogId===t);return-1!==e&&_.splice(e,1),{data:{success:!0}}}return I.delete(`/favorites/${t}`)};var R={name:"FavoriteButton",props:{blogId:{type:Number,required:!0}},data(){return{isFavorited:!1,loading:!1}},created(){this.fetchFavoriteStatus()},methods:{async fetchFavoriteStatus(){try{this.loading=!0;const t=await x(this.blogId);this.isFavorited=t.data?.isFavorite||!1}catch(t){console.error("Ëé∑ÂèñÊî∂ËóèÁä∂ÊÄÅÂ§±Ë¥•:",t)}finally{this.loading=!1}},async toggleFavorite(){if(!this.loading)try{this.loading=!0,this.isFavorited?(await $(this.blogId),this.isFavorited=!1,this.$emit("unfavorited")):(await A(this.blogId),this.isFavorited=!0,this.$emit("favorited"))}catch(t){console.error("Êõ¥Êñ∞Êî∂ËóèÁä∂ÊÄÅÂ§±Ë¥•:",t)}finally{this.loading=!1}}}},z=R,T=(0,v.A)(z,C,b,!1,null,"1eee9738",null),N=T.exports,B=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-section"},[e("h3",{staticClass:"section-title"},[t._v("ËØÑËÆ∫ ("+t._s(t.comments.length)+")")]),e("div",{staticClass:"comment-input-wrapper"},[e("div",{staticClass:"comment-input-box"},[t.commentImages&&t.commentImages.length>0?e("div",{staticClass:"comment-images-preview"},t._l(t.commentImages,function(i,s){return e("div",{key:`preview-${s}`,staticClass:"comment-image-preview-item"},[e("img",{staticClass:"comment-image-preview",attrs:{src:i.previewUrl,alt:i.fileName}}),e("button",{staticClass:"remove-image-btn",attrs:{disabled:t.submitting||t.uploadingImage},on:{click:function(e){return t.removeCommentImage(s)}}},[t._v(" √ó ")])])}),0):t._e(),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.newComment,expression:"newComment"}],attrs:{placeholder:"ÂÜô‰∏ã‰Ω†ÁöÑËØÑËÆ∫...",rows:"3",disabled:t.uploadingImage},domProps:{value:t.newComment},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.submitComment.apply(null,arguments):null},input:[function(e){e.target.composing||(t.newComment=e.target.value)},function(e){return t.handleAtInput(e,null)}]}}),e("div",{staticClass:"comment-actions"},[e("span",{staticClass:"hint"},[t._v("Êåâ Ctrl+Enter ÂèëÈÄÅ")]),e("label",{staticClass:"upload-image-btn",attrs:{disabled:t.commentImages.length>=t.maxImages||t.uploadingImage}},[t._v(" üì∑ "+t._s(t.commentImages.length)+"/"+t._s(t.maxImages)+" "),e("input",{staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*",multiple:"",disabled:t.commentImages.length>=t.maxImages||t.uploadingImage},on:{change:t.handleImageSelect}}),t.uploadingImage?e("span",{staticClass:"uploading-indicator"},[t._v("‰∏ä‰º†‰∏≠...")]):t._e()]),e("button",{staticClass:"submit-btn",attrs:{disabled:!t.newComment.trim()&&0===t.commentImages.length||t.submitting||t.uploadingImage},on:{click:t.submitComment}},[t._v(" "+t._s(t.submitting?"Êèê‰∫§‰∏≠...":"ÂèëË°®ËØÑËÆ∫")+" ")])])])]),t.comments.length>0?e("div",{staticClass:"comment-list"},t._l(t.comments,function(i){return e("div",{key:i.id,staticClass:"comment-item"},[e("div",{staticClass:"comment-avatar"},[e("img",{staticClass:"user-avatar",attrs:{src:i.avatar||"/avatar/default.png",alt:i.userName||"ÂåøÂêçÁî®Êà∑"}})]),e("div",{staticClass:"comment-body"},[e("div",{staticClass:"comment-header"},[e("span",{staticClass:"user-name"},[t._v(t._s(i.userName||"ÂåøÂêçÁî®Êà∑"))]),e("span",{staticClass:"user-level",class:`level-${i.level||1}`},[t._v("Lv."+t._s(i.level||1))]),e("span",{staticClass:"comment-time"},[t._v(t._s(t.formatTime(i.createdAt)))])]),e("div",{staticClass:"comment-content"},[t._v(t._s(i.content))]),e("div",{staticClass:"comment-footer"},[e("button",{staticClass:"like-comment-btn",class:{liked:i.isLiked},attrs:{disabled:i.liking},on:{click:function(e){return t.toggleCommentLike(i.id)}}},[e("span",[t._v(t._s((i.isLiked,"üëç")))]),e("span",[t._v(t._s(i.likeCount||i.likes||0))]),i.liking?e("span",[t._v("...")]):t._e()]),e("button",{staticClass:"reply-comment-btn",on:{click:function(e){return t.showReplyBox(i.id)}}},[t._v(" ÂõûÂ§ç ")])]),i.replies&&i.replies.length>0?e("div",{staticClass:"replies-list"},t._l(i.replies,function(s){return e("div",{key:s.id,staticClass:"reply-item"},[e("div",{staticClass:"comment-avatar"},[e("img",{staticClass:"user-avatar",attrs:{src:s.avatar||"/avatar/default.png",alt:s.userName||"ÂåøÂêçÁî®Êà∑"}})]),e("div",{staticClass:"comment-body"},[e("div",{staticClass:"comment-header"},[e("span",{staticClass:"user-name"},[t._v(t._s(s.userName||"ÂåøÂêçÁî®Êà∑"))]),e("span",{staticClass:"user-level",class:`level-${s.level||1}`},[t._v("Lv."+t._s(s.level||1))]),e("span",{staticClass:"comment-time"},[t._v(t._s(t.formatTime(s.createdAt)))])]),e("div",{staticClass:"comment-content"},[t._v(t._s(s.content))]),e("div",{staticClass:"comment-footer"},[e("button",{staticClass:"like-comment-btn",class:{liked:s.isLiked},attrs:{disabled:s.liking},on:{click:function(e){return t.toggleReplyLike(i.id,s.id)}}},[e("span",[t._v(t._s((s.isLiked,"üëç")))]),e("span",[t._v(t._s(s.likes||0))]),s.liking?e("span",[t._v("...")]):t._e()]),e("button",{staticClass:"reply-comment-btn",on:{click:function(e){return t.showReplyBox(i.id,{userName:s.userName})}}},[t._v(" ÂõûÂ§ç ")])])])])}),0):t._e(),t.replyStates[i.id]&&t.replyStates[i.id].showReplyBox?e("div",{staticClass:"reply-input-wrapper"},[e("div",{staticClass:"reply-input-box"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.replyStates[i.id].replyContent,expression:"replyStates[comment.id].replyContent"}],ref:`replyInput-${i.id}`,refInFor:!0,class:`reply-input-${i.id}`,attrs:{placeholder:"ÂÜô‰∏ã‰Ω†ÁöÑÂõûÂ§ç...",rows:"2"},domProps:{value:t.replyStates[i.id].replyContent},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.submitReply(i.id):null},input:[function(e){e.target.composing||t.$set(t.replyStates[i.id],"replyContent",e.target.value)},function(e){return t.handleAtInput(e,i.id)}]}}),e("div",{staticClass:"comment-actions"},[e("span",{staticClass:"hint"},[t._v("Êåâ Ctrl+Enter ÂèëÈÄÅ")]),e("div",{staticClass:"reply-buttons"},[e("button",{staticClass:"cancel-btn",on:{click:function(e){return t.hideReplyBox(i.id)}}},[t._v(" ÂèñÊ∂à ")]),e("button",{staticClass:"submit-btn",attrs:{disabled:!t.replyStates[i.id].replyContent.trim()||t.replyStates[i.id].submitting},on:{click:function(e){return t.submitReply(i.id)}}},[t._v(" "+t._s(t.replyStates[i.id].submitting?"Êèê‰∫§‰∏≠...":"ÂèëË°®ÂõûÂ§ç")+" ")])])])])]):t._e()])])}),0):t.loading?t._e():e("div",{staticClass:"empty-comments"},[t._v(" ÊöÇÊó†ËØÑËÆ∫ÔºåÂø´Êù•ÂèëË°®Á¨¨‰∏ÄÊù°ËØÑËÆ∫ÂêßÔºÅ ")]),t.loading?e("div",{staticClass:"loading-comments"},[t._v(" Âä†ËΩΩËØÑËÆ∫‰∏≠... ")]):t._e()])},F=[];i(7588),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698),i(4603),i(7566),i(8721);const P=!0,D=d().create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json"}}),E=[{id:1,blogId:1,userId:"user2",userName:"Âº†Â∞èÊòé",avatar:"/avatar/user2.png",level:3,content:"ËøôÁØáÊñáÁ´†ÂÜôÂæóÁúü‰∏çÈîôÔºåÂ≠¶Âà∞‰∫ÜÂæàÂ§öÔºÅ",likes:5,createdAt:"2024-03-10T14:30:00",isLiked:!1,images:[],replies:[{id:101,parentId:1,userId:"user1",userName:"ÂΩìÂâçÁî®Êà∑",avatar:"/avatar/current_user.png",level:4,content:"ÊòØÁöÑÔºåÁ°ÆÂÆûÂæàÊúâÂ∏ÆÂä©ÔºÅ",likes:2,createdAt:"2024-03-10T15:00:00",isLiked:!1,images:[]}]},{id:2,blogId:1,userId:"user3",userName:"ÊùéÂçé",avatar:"/avatar/user3.png",level:5,content:"ÊÑüË∞¢ÂàÜ‰∫´ÔºåÂØπÊàëÂæàÊúâÂ∏ÆÂä©",likes:2,createdAt:"2024-03-11T09:15:00",isLiked:!1,images:[],replies:[]},{id:3,blogId:2,userId:"user4",userName:"ÁéãÂº∫",avatar:"/avatar/user4.png",level:2,content:"Spring BootÁ°ÆÂÆûÂæàÂº∫Â§ßÔºåÊúüÂæÖÊõ¥Â§öÁõ∏ÂÖ≥ÂÜÖÂÆπ",likes:8,createdAt:"2024-03-12T16:45:00",isLiked:!0,images:[],replies:[]},{id:4,blogId:3,userId:"user5",userName:"ËµµÊïè",avatar:"/avatar/user5.png",level:7,content:"ÂâçÂêéÁ´ØÂàÜÁ¶ªÊòØÂ§ßÂäøÊâÄË∂ãÔºåËøôÁØáÊñáÁ´†ÂàÜÊûêÂæóÂæàÂà∞‰Ωç",likes:12,createdAt:"2024-03-13T11:20:00",isLiked:!1,images:[],replies:[{id:102,parentId:4,userId:"user3",userName:"ÊùéÂçé",avatar:"/avatar/user3.png",level:5,content:"@ËµµÊïè ÂÆåÂÖ®ÂêåÊÑè‰Ω†ÁöÑËßÇÁÇπÔºÅ",likes:3,createdAt:"2024-03-13T12:00:00",isLiked:!1,images:[]}]}],U="user1",M="ÂΩìÂâçÁî®Êà∑",O="/avatar/current_user.png",j=4,H=t=>new Promise(e=>setTimeout(e,t)),K=async t=>P?(await H(400),{data:E.filter(e=>e.blogId===t).sort((t,e)=>new Date(e.createdAt)-new Date(t.createdAt))}):D.get(`/comments/blog/${t}`),q=async(t,e,i=[])=>{if(P){await H(300);const s=Math.max(...E.map(t=>t.id),0)+1,n={id:s,blogId:t,userId:U,userName:M,avatar:O,level:j,content:e,likes:0,createdAt:(new Date).toISOString(),isLiked:!1,images:i,replies:[]};return E.push(n),{data:n}}return D.post("/comments",{blogId:t,content:e,images:i})},G=async(t,e,i,s=[])=>{if(P){await H(300);const n=E.find(e=>e.id===t);if(!n)throw new Error("Áà∂ËØÑËÆ∫‰∏çÂ≠òÂú®");let a=0;E.forEach(t=>{if(t.replies&&t.replies.length>0){const e=Math.max(...t.replies.map(t=>t.id),0);a=Math.max(a,e)}});const r=i?`@${i} ${e}`:e,o={id:a+1,parentId:t,userId:U,userName:M,avatar:O,level:j,content:r,likes:0,createdAt:(new Date).toISOString(),isLiked:!1,images:s};return n.replies.push(o),{data:o}}return D.post(`/comments/${t}/replies`,{content:e,replyToUser:i,images:s})},V=async(t,e)=>{if(P){await H(200);const i=E.find(e=>e.id===t);if(i){const t=i.replies.find(t=>t.id===e);t&&(t.likes+=1,t.isLiked=!0)}return{data:{success:!0}}}return D.post(`/comments/${t}/replies/${e}/like`)},Y=async(t,e)=>{if(P){await H(200);const i=E.find(e=>e.id===t);if(i){const t=i.replies.find(t=>t.id===e);t&&t.likes>0&&(t.likes-=1,t.isLiked=!1)}return{data:{success:!0}}}return D.delete(`/comments/${t}/replies/${e}/like`)},W=async t=>{if(P){await H(200);const e=E.find(e=>e.id===t);return e&&(e.likes+=1,e.isLiked=!0),{data:{success:!0}}}return D.post(`/comments/${t}/like`)},J=async t=>{if(P){await H(200);const e=E.find(e=>e.id===t);return e&&e.likes>0&&(e.likes-=1,e.isLiked=!1),{data:{success:!0}}}return D.delete(`/comments/${t}/like`)};var Q={name:"CommentList",props:{blogId:{type:Number,required:!0}},data(){return{comments:[],newComment:"",loading:!1,submitting:!1,replyStates:{},atUserList:[],commentImages:[],uploadingImage:!1,maxImages:9}},created(){this.fetchComments()},mounted(){this.initializeReplyStates()},updated(){this.initializeReplyStates()},created(){this.fetchComments()},methods:{initializeReplyStates(){this.comments.forEach(t=>{this.replyStates[t.id]||this.$set(this.replyStates,t.id,{showReplyBox:!1,replyContent:"",submitting:!1,replyingTo:null}),t.replies||(t.replies=[]),t.replies.forEach(t=>{t.isLiked||(t.isLiked=!1),t.liking||(t.liking=!1)})})},async fetchComments(){try{this.loading=!0;const t=await K(this.blogId);this.comments=t.data.map(t=>({...t,isLiked:t.isLiked||!1,likeCount:t.likeCount||t.likes||0,liking:!1,replies:t.replies||[]})),this.cacheUsersForAtFeature()}catch(t){console.error("Ëé∑ÂèñËØÑËÆ∫Â§±Ë¥•:",t)}finally{this.loading=!1}},cacheUsersForAtFeature(){const t=new Set;this.comments.forEach(e=>{t.add({id:e.userId,name:e.userName}),e.replies&&e.replies.forEach(e=>{t.add({id:e.userId,name:e.userName})})}),this.atUserList=Array.from(t)},handleAtInput(t,e){const i=t.target.value,s=t.target.selectionStart,n=i.substring(0,s),a=n.lastIndexOf("@");if(-1!==a){const t=n.substring(a+1);(""===t||/^\s*$/.test(t))&&console.log("Show at user list")}},insertAtUser(t,e){const i=this.replyStates[e];i&&(i.replyContent+=`@${t} `)},async submitComment(){if((this.newComment.trim()||0!==this.commentImages.length)&&!this.submitting)try{this.submitting=!0;const t=this.formatImagesForApi(this.commentImages),e=await q(this.blogId,this.newComment,t);if(e.data){const i={...e.data,isLiked:!1,likeCount:0,liking:!1,replies:[],images:t};this.comments.unshift(i),this.newComment="",this.commentImages.forEach(t=>{t.previewUrl&&URL.revokeObjectURL(t.previewUrl)}),this.commentImages=[],this.cacheUsersForAtFeature()}}catch(t){console.error("Êèê‰∫§ËØÑËÆ∫Â§±Ë¥•:",t)}finally{this.submitting=!1}},showImagePreview(t){window.open(t,"_blank")},async handleImageSelect(t){const e=Array.from(t.target.files);if(0===e.length)return;const i=this.maxImages-this.commentImages.length;if(e.length>i)alert(`ÊúÄÂ§öÂè™ËÉΩ‰∏ä‰º†${this.maxImages}Âº†ÂõæÁâáÔºåËøòÂèØ‰ª•‰∏ä‰º†${i}Âº†`);else{this.uploadingImage=!0;try{for(const t of e){if(!t.type.startsWith("image/")){alert("ËØ∑‰∏ä‰º†ÂõæÁâáÊñá‰ª∂");continue}if(t.size>5242880){alert("ÂõæÁâáÂ§ßÂ∞è‰∏çËÉΩË∂ÖËøá5MB");continue}const e=URL.createObjectURL(t);this.commentImages.push({file:t,previewUrl:e,fileName:t.name})}}catch(s){console.error("Â§ÑÁêÜÂõæÁâáÂ§±Ë¥•:",s),alert("Â§ÑÁêÜÂõæÁâáÂ§±Ë¥•ÔºåËØ∑ÈáçËØï")}finally{this.uploadingImage=!1,t.target.value=""}}},removeCommentImage(t){const e=this.commentImages[t];e.previewUrl&&URL.revokeObjectURL(e.previewUrl),this.commentImages.splice(t,1)},formatImagesForApi(t){return t.map(t=>({fileName:t.fileName,url:t.previewUrl,size:t.file?t.file.size:0}))},async toggleCommentLike(t){const e=this.comments.find(e=>e.id===t);if(e&&!e.liking)try{let i;e.liking=!0,i=e.isLiked?await J(t):await W(t),i.data&&(e.isLiked=i.data.isLiked,e.likeCount=i.data.likeCount||e.likeCount+(e.isLiked?1:-1))}catch(i){console.error("ÁÇπËµûËØÑËÆ∫Â§±Ë¥•:",i)}finally{e.liking=!1}},async toggleReplyLike(t,e){const i=this.comments.find(e=>e.id===t);if(!i)return;const s=i.replies.find(t=>t.id===e);if(s&&!s.liking)try{let i;s.liking=!0,i=s.isLiked?await Y(t,e):await V(t,e),i.data&&(s.isLiked=!s.isLiked,s.likes=s.likes+(s.isLiked?1:-1))}catch(n){console.error("ÁÇπËµûÂõûÂ§çÂ§±Ë¥•:",n)}finally{s.liking=!1}},showReplyBox(t,e=null){this.replyStates[t]||this.$set(this.replyStates,t,{showReplyBox:!1,replyContent:"",submitting:!1,replyingTo:null}),this.replyStates[t].showReplyBox=!0,this.replyStates[t].replyingTo=e,this.replyStates[t].replyContent=e?`@${e.userName} `:"",this.$nextTick(()=>{const e=document.querySelector(`.reply-input-${t}`);e&&e.focus()})},hideReplyBox(t){this.replyStates[t]&&(this.replyStates[t].showReplyBox=!1,this.replyStates[t].replyContent="",this.replyStates[t].replyingTo=null)},async submitReply(t){const e=this.replyStates[t];if(e&&e.replyContent.trim()&&!e.submitting)try{e.submitting=!0;const i=e.replyContent.trim(),s=e.replyingTo?e.replyingTo.userName:null,n=await G(t,i,s);if(n.data){const e=this.comments.find(e=>e.id===t);e&&e.replies.push({...n.data,isLiked:!1,liking:!1}),this.hideReplyBox(t)}}catch(i){console.error("ÂõûÂ§çËØÑËÆ∫Â§±Ë¥•:",i)}finally{e.submitting=!1}},formatTime(t){if(!t)return"";const e=new Date(t),i=new Date,s=i-e;return s<6e4?"ÂàöÂàö":s<36e5?`${Math.floor(s/6e4)}ÂàÜÈíüÂâç`:s<864e5?`${Math.floor(s/36e5)}Â∞èÊó∂Ââç`:s<2592e6?`${Math.floor(s/864e5)}Â§©Ââç`:`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}}},X=Q,Z=(0,v.A)(X,B,F,!1,null,"325a6dd2",null),tt=Z.exports,et={name:"BlogDetail",components:{LikeButton:y,FavoriteButton:N,CommentList:tt},data(){return{blog:null,loading:!0,progressCheckInterval:null}},created(){this.loadBlogDetail()},mounted(){window.addEventListener("scroll",this.handleScroll),this.progressCheckInterval=setInterval(()=>{this.saveReadProgress()},1e4)},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll),this.progressCheckInterval&&clearInterval(this.progressCheckInterval),this.saveReadProgress(100)},methods:{async loadBlogDetail(){try{const t=this.$route.params.id,e=await(0,a.cS)(t);this.blog=e.data,await(0,r.GG)(parseInt(t))}catch(t){console.error("Ëé∑ÂèñÂçöÂÆ¢ËØ¶ÊÉÖÂ§±Ë¥•:",t)}finally{this.loading=!1}},handleLikeChange(t){this.blog.likeCount=t.likeCount,this.blog.isLiked=t.isLiked},goBack(){this.$router.push("/")},formatDate(t){if(!t)return"";const e=new Date(t);return e.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},handleScroll(){},async saveReadProgress(t=null){if(this.blog)try{let e=t;if(null===e){const t=window.scrollY,i=document.documentElement.scrollHeight-window.innerHeight;e=i>0?Math.min(100,Math.round(t/i*100)):0}(e>=10||null!==t)&&await(0,r.lP)(this.blog.id,e)}catch(e){console.error("‰øùÂ≠òÈòÖËØªËøõÂ∫¶Â§±Ë¥•:",e)}}}},it=et,st=(0,v.A)(it,s,n,!1,null,"02df50f6",null),nt=st.exports},1698:function(t,e,i){var s=i(6518),n=i(4204),a=i(9835),r=i(4916),o=!r("union")||!a("union");s({target:"Set",proto:!0,real:!0,forced:o},{union:n})},2475:function(t,e,i){var s=i(6518),n=i(8527),a=i(4916),r=!a("isSupersetOf",function(t){return!t});s({target:"Set",proto:!0,real:!0,forced:r},{isSupersetOf:n})},2564:function(t,e,i){i.d(e,{GG:function(){return u},Me:function(){return g},c1:function(){return d},lP:function(){return m}});i(4114);var s=i(2505),n=i.n(s);const a=!0,r=n().create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json"}}),o=[{id:1,blogId:3,userId:"user1",readAt:"2024-03-20T10:30:00",readProgress:100},{id:2,blogId:5,userId:"user1",readAt:"2024-03-19T14:20:00",readProgress:80},{id:3,blogId:7,userId:"user1",readAt:"2024-03-18T09:15:00",readProgress:100},{id:4,blogId:1,userId:"user1",readAt:"2024-03-17T16:45:00",readProgress:100},{id:5,blogId:9,userId:"user1",readAt:"2024-03-16T11:20:00",readProgress:60}],l="user1",c=t=>new Promise(e=>setTimeout(e,t)),d=async(t=20)=>a?(await c(300),{data:[...o].filter(t=>t.userId===l).sort((t,e)=>new Date(e.readAt)-new Date(t.readAt)).slice(0,t)}):r.get(`/history?limit=${t}`),u=async(t,e=0)=>{if(a){await c(200);const i=o.findIndex(e=>e.userId===l&&e.blogId===t),s=(new Date).toISOString();if(-1!==i)return o[i].readAt=s,o[i].readProgress=Math.max(o[i].readProgress,e),{data:o[i]};{const i=Math.max(...o.map(t=>t.id),0)+1,n={id:i,blogId:t,userId:l,readAt:s,readProgress:e};return o.push(n),{data:n}}}return r.post("/history",{blogId:t,readProgress:e})},m=async(t,e)=>{if(a){await c(100);const i=o.find(e=>e.userId===l&&e.blogId===t);return i&&(i.readProgress=Math.max(i.readProgress,e)),{data:{success:!0}}}return r.put(`/history/blog/${t}/progress`,{readProgress:e})},g=async()=>{if(a){await c(300);const t=o.findIndex(t=>t.userId===l);while(-1!==t)o.splice(t,1),t=o.findIndex(t=>t.userId===l);return{data:{success:!0}}}return r.delete("/history")}},2812:function(t){var e=TypeError;t.exports=function(t,i){if(t<i)throw new e("Not enough arguments");return t}},3440:function(t,e,i){var s=i(7080),n=i(4402),a=i(9286),r=i(5170),o=i(3789),l=i(8469),c=i(507),d=n.has,u=n.remove;t.exports=function(t){var e=s(this),i=o(t),n=a(e);return r(e)<=i.size?l(e,function(t){i.includes(t)&&u(n,t)}):c(i.getIterator(),function(t){d(n,t)&&u(n,t)}),n}},3650:function(t,e,i){var s=i(7080),n=i(4402),a=i(9286),r=i(3789),o=i(507),l=n.add,c=n.has,d=n.remove;t.exports=function(t){var e=s(this),i=r(t).getIterator(),n=a(e);return o(i,function(t){c(e,t)?d(n,t):l(n,t)}),n}},3789:function(t,e,i){var s=i(9306),n=i(8551),a=i(9565),r=i(1291),o=i(1767),l="Invalid size",c=RangeError,d=TypeError,u=Math.max,m=function(t,e){this.set=t,this.size=u(e,0),this.has=s(t.has),this.keys=s(t.keys)};m.prototype={getIterator:function(){return o(n(a(this.keys,this.set)))},includes:function(t){return a(this.has,this.set,t)}},t.exports=function(t){n(t);var e=+t.size;if(e!==e)throw new d(l);var i=r(e);if(i<0)throw new c(l);return new m(t,i)}},3838:function(t,e,i){var s=i(7080),n=i(5170),a=i(8469),r=i(3789);t.exports=function(t){var e=s(this),i=r(t);return!(n(e)>i.size)&&!1!==a(e,function(t){if(!i.includes(t))return!1},!0)}},3853:function(t,e,i){var s=i(6518),n=i(4449),a=i(4916),r=!a("isDisjointFrom",function(t){return!t});s({target:"Set",proto:!0,real:!0,forced:r},{isDisjointFrom:n})},4204:function(t,e,i){var s=i(7080),n=i(4402).add,a=i(9286),r=i(3789),o=i(507);t.exports=function(t){var e=s(this),i=r(t).getIterator(),l=a(e);return o(i,function(t){n(l,t)}),l}},4402:function(t,e,i){var s=i(9504),n=Set.prototype;t.exports={Set:Set,add:s(n.add),has:s(n.has),remove:s(n["delete"]),proto:n}},4449:function(t,e,i){var s=i(7080),n=i(4402).has,a=i(5170),r=i(3789),o=i(8469),l=i(507),c=i(9539);t.exports=function(t){var e=s(this),i=r(t);if(a(e)<=i.size)return!1!==o(e,function(t){if(i.includes(t))return!1},!0);var d=i.getIterator();return!1!==l(d,function(t){if(n(e,t))return c(d,"normal",!1)})}},4603:function(t,e,i){var s=i(6840),n=i(9504),a=i(655),r=i(2812),o=URLSearchParams,l=o.prototype,c=n(l.append),d=n(l["delete"]),u=n(l.forEach),m=n([].push),g=new o("a=1&a=2&b=3");g["delete"]("a",1),g["delete"]("b",void 0),g+""!=="a=2"&&s(l,"delete",function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return d(this,t);var s=[];u(this,function(t,e){m(s,{key:e,value:t})}),r(e,1);var n,o=a(t),l=a(i),g=0,h=0,p=!1,f=s.length;while(g<f)n=s[g++],p||n.key===o?(p=!0,d(this,n.key)):h++;while(h<f)n=s[h++],n.key===o&&n.value===l||c(this,n.key,n.value)},{enumerable:!0,unsafe:!0})},4916:function(t,e,i){var s=i(7751),n=function(t){return{size:t,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},a=function(t){return{size:t,has:function(){return!0},keys:function(){throw new Error("e")}}};t.exports=function(t,e){var i=s("Set");try{(new i)[t](n(0));try{return(new i)[t](n(-1)),!1}catch(o){if(!e)return!0;try{return(new i)[t](a(-1/0)),!1}catch(l){var r=new i;return r.add(1),r.add(2),e(r[t](a(1/0)))}}}catch(l){return!1}}},5024:function(t,e,i){var s=i(6518),n=i(3650),a=i(9835),r=i(4916),o=!r("symmetricDifference")||!a("symmetricDifference");s({target:"Set",proto:!0,real:!0,forced:o},{symmetricDifference:n})},5170:function(t,e,i){var s=i(6706),n=i(4402);t.exports=s(n.proto,"size","get")||function(t){return t.size}},5876:function(t,e,i){var s=i(6518),n=i(3838),a=i(4916),r=!a("isSubsetOf",function(t){return t});s({target:"Set",proto:!0,real:!0,forced:r},{isSubsetOf:n})},6706:function(t,e,i){var s=i(9504),n=i(9306);t.exports=function(t,e,i){try{return s(n(Object.getOwnPropertyDescriptor(t,e)[i]))}catch(a){}}},7080:function(t,e,i){var s=i(4402).has;t.exports=function(t){return s(t),t}},7566:function(t,e,i){var s=i(6840),n=i(9504),a=i(655),r=i(2812),o=URLSearchParams,l=o.prototype,c=n(l.getAll),d=n(l.has),u=new o("a=1");!u.has("a",2)&&u.has("a",void 0)||s(l,"has",function(t){var e=arguments.length,i=e<2?void 0:arguments[1];if(e&&void 0===i)return d(this,t);var s=c(this,t);r(e,1);var n=a(i),o=0;while(o<s.length)if(s[o++]===n)return!0;return!1},{enumerable:!0,unsafe:!0})},7588:function(t,e,i){var s=i(6518),n=i(9565),a=i(2652),r=i(9306),o=i(8551),l=i(1767),c=i(9539),d=i(4549),u=d("forEach",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{forEach:function(t){o(this);try{r(t)}catch(s){c(this,"throw",s)}if(u)return n(u,this,t);var e=l(this),i=0;a(e,function(e){t(e,i++)},{IS_RECORD:!0})}})},7642:function(t,e,i){var s=i(6518),n=i(3440),a=i(9039),r=i(4916),o=!r("difference",function(t){return 0===t.size}),l=o||a(function(){var t={size:1,has:function(){return!0},keys:function(){var t=0;return{next:function(){var i=t++>1;return e.has(1)&&e.clear(),{done:i,value:2}}}}},e=new Set([1,2,3,4]);return 3!==e.difference(t).size});s({target:"Set",proto:!0,real:!0,forced:l},{difference:n})},8004:function(t,e,i){var s=i(6518),n=i(9039),a=i(8750),r=i(4916),o=!r("intersection",function(t){return 2===t.size&&t.has(1)&&t.has(2)})||n(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))});s({target:"Set",proto:!0,real:!0,forced:o},{intersection:a})},8469:function(t,e,i){var s=i(9504),n=i(507),a=i(4402),r=a.Set,o=a.proto,l=s(o.forEach),c=s(o.keys),d=c(new r).next;t.exports=function(t,e,i){return i?n({iterator:c(t),next:d},e):l(t,e)}},8527:function(t,e,i){var s=i(7080),n=i(4402).has,a=i(5170),r=i(3789),o=i(507),l=i(9539);t.exports=function(t){var e=s(this),i=r(t);if(a(e)<i.size)return!1;var c=i.getIterator();return!1!==o(c,function(t){if(!n(e,t))return l(c,"normal",!1)})}},8721:function(t,e,i){var s=i(3724),n=i(9504),a=i(2106),r=URLSearchParams.prototype,o=n(r.forEach);s&&!("size"in r)&&a(r,"size",{get:function(){var t=0;return o(this,function(){t++}),t},configurable:!0,enumerable:!0})},8750:function(t,e,i){var s=i(7080),n=i(4402),a=i(5170),r=i(3789),o=i(8469),l=i(507),c=n.Set,d=n.add,u=n.has;t.exports=function(t){var e=s(this),i=r(t),n=new c;return a(e)>i.size?l(i.getIterator(),function(t){u(e,t)&&d(n,t)}):o(e,function(t){i.includes(t)&&d(n,t)}),n}},9286:function(t,e,i){var s=i(4402),n=i(8469),a=s.Set,r=s.add;t.exports=function(t){var e=new a;return n(t,function(t){r(e,t)}),e}},9835:function(t){t.exports=function(t){try{var e=new Set,i={size:0,has:function(){return!0},keys:function(){return Object.defineProperty({},"next",{get:function(){return e.clear(),e.add(4),function(){return{done:!0}}}})}},s=e[t](i);return 1===s.size&&4===s.values().next().value}catch(n){return!1}}}}]);
//# sourceMappingURL=157.d0d98e44.js.map